---
output:
  html_document: default
  pdf_document: default
---

---
title: "Rules & Tenure Models"
output:
  html_document:
    df_print: paged
  pdf_document: default
---
-2020-01-31: Best fits to use for table:hypw, hyps, hypwotr,

-2020-01-22: versioned the prior iteration of this that included manual calculation of predicted vals/effect sizes for all the params. can do that w sjPlot more quickly. 
-2019-12-6: versioned the prior iteration of this that included all the old model comparisons and restarted w new based on the new tabel of hypothesized relationships from our call on Dec. 5

[Leftover:]
TO DO:
-figure out how to run MCMC for the pval estimations...
- Set some global viz params to use for plots below.
-[Done 19-9-10]save all of the data import and wrangling to a separate script and export to an rdata file that we call back in here. 
-[Done 19-09-30]pull out summary stats and cross-tabs to separate script.
```{r setup, echo = FALSE, message = FALSE, include = FALSE, warning= FALSE, cache= TRUE}
library(haven)  # this is the new package to use instead of (foreign)
#library(corrplot)
library(magrittr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(readxl)
library(knitr)
library(summarytools)
library(lme4)
library(sjPlot)
library(sjmisc)
library(stringr)
library(kableExtra)
library(qwraps2)

options(scipen = 999)

# This is pulled from teh vignette for the summarytools pkg, which gives
# these suggested specifications to enable easy viewing of outputs:
# https://cran.r-project.org/web/packages/summarytools/vignettes/Introduction.html

opts_chunk$set(results = 'asis',      # This is essential (can also be set #at the chunk-level)
                comment = NA, 
                prompt = FALSE, 
                cache = FALSE, # additional global settings I want to have for this doc:
                message = FALSE,
                warning = FALSE)

st_options(plain.ascii = FALSE,        # This is very handy in all Rmd documents
            style = "rmarkdown",        # This too
            footnote = NA,             # Avoids footnotes which would clutter the results
            subtitle.emphasis = FALSE  # This is a setting to experiment with - according tothe theme used, it might improve the headings layout
           )   

```

```{r, echo=FALSE, message=FALSE}
# this setting also also suggested from summarytools vignette:
st_css()                              # This is a must; without it, expect odd layout,
                                      # especially with dfSummary()

theme_set(theme_sjplot())
```

---- Data prep now located in 1_RTM-datapull.R: (hidden in report view)  
< not including Use params in the dataframe called td now >
That script does the following:
1. Everything is straight factors, num or chr except for Rules which is ordered.
2. Recodes household-level tenure vars:  
3. Per discussion on Jan 7 2018, have condensed use & possession responses in to one category. 
4. Adds dummy Vars for Rules : [this is only useful for a few of the models]
5. Creates a subset of the df that removes all records w/ NAs in Social capital
---- Data exploration and cross tabs now located in 2_RTM_dataexplore.R
 That script does the following:
1. basic cross tabs and chisq tests for assoc btwn model params


# Load Rdata files 
```{r, echo = FALSE}
load("./data/td.RData")

td.fg$Soum <- as.factor(td.fg$Soum)
td.fg$Aimag <- as.factor(td.fg$Aimag)
#td.fg%<>% mutate(frg.left = (100-frgUse)) %>% rename(frgCV = CV)
```
#more data explore:
```{r}
table(td.fg$Wotor, td.fg$ResWint)%>% kable(col.names = c("RsvWPast-No",
                           "RsvWPast-Y")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)
table(td.fg$Wotor, td.fg$ez) %>%
  kable(col.names = c("DS", "ST", "ES", "FMS")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)

table(td.fg$Fotor, td.fg$ResWint)%>% kable(col.names = c("RsvWPast-No",
                           "RsvWPast-Y")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)
table(td.fg$Fotor, td.fg$ez) %>%
  kable(col.names = c("DS", "ST", "ES", "FMS")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)

table(td.fg$hhTenureWPast, td.fg$ez) %>%
  kable(col.names = c("DS", "ST", "ES", "FMS")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)

table(td.fg$hhTenureSpPast, td.fg$ez) %>%
  kable(col.names = c("DS", "ST", "ES", "FMS")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)

table(td.fg$ContractWPast, td.fg$ez) %>%
  kable(col.names = c("DS", "ST", "ES", "FMS")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)

table(td.fg$ContractSpPast, td.fg$ez) %>%
  kable(col.names = c("DS", "ST", "ES", "FMS")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)

table(td.fg$hhTenureWCamp, td.fg$ez) %>%
  kable(col.names = c("DS", "ST", "ES", "FMS")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)

table(td.fg$hhTenureSpCamp, td.fg$ez) %>%
  kable(col.names = c("DS", "ST", "ES", "FMS")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)
```


# MODELS:
# placeholder for formula code:
*Eq. 1*: $y_{ij} = \gamma_{00} + U_{0j}$

where $y_i$ is the dependent variable measured at houhold $i$ in organization $j$. Model 1 was used as the baseline model to estimate the group-level variance in the dependent variable. We compared each model to an intercept-only model and models w random intercepts performed better in both instances.


*Eq. 2*: $y^*_{ij} = x_{ij}'\beta + u_i + \epsilon_{ij}$,




### 2.1 Null Model & random effects
Determining support for specifying random effect for Organization. 
[We are going w Org, not Soum bc we have a hypothesis re: more var in herder practices between Orgs than within]

The estimate of the constant is the logit of the proportion Reserving Pastures:
Testing null models w just the randon intercept specified, to see which of these accounts for the most var. 
None of these models are significant in and of themselves, acording to straight p-vals, but by examining the AIC/BIC across the models we can see that for the Winter Pastures there is variation across Soum and Org (more variation between than within) and  
for the Spring Pastures there is more var across only Soums, not Org.  
But no support for random intercepts by ecological zone (jives with results from other model runs).

[Based on these I am going to just go w Org as grouping var (random) for both w & sp]
```{r}
nullw  <-  glm ( ResWint ~ 1 , data=td, family=binomial)   # AIC = 977
nullw.r <-  glmer( ResWint ~ 1 + (1|Org), data=td, family=binomial) #AIC = 947.2
nullw.re <-  glmer( ResWint ~ 1 + (1|ez), data=td, family=binomial) #worse
nullw.rs <-  glmer( ResWint ~ 1 + (1|Soum), data=td, family=binomial) #better
nullw.rso <-  glmer( ResWint ~ 1 + (1|Soum) + (1|Org), data=td, family=binomial)  #best, AIC = 934.4
nullw.rsxo <-  glmer( ResWint ~ 1 + (Org|Soum), data=td, family=binomial)  
#anova(nullw.r, nullw.re, nullw.rs, nullw.rso, nullw.rsxo)
print(anova(nullw.r, nullw.rs, nullw.rso)) 

nulls  <-  glm ( ResSpr ~ 1 , data = td, family = binomial)
nulls.r <-  glmer( ResSpr ~ 1 + (1|Org), data = td, family = binomial) #better  AIC = 950
nulls.re <-  glmer( ResSpr ~ 1 + (1|ez), data = td, family = binomial) #worse
nulls.rs <-  glmer( ResSpr ~ 1 + (1|Soum), data = td, family = binomial) #better  (best, AIC = 913)
nulls.rso <-  glmer( ResSpr ~ 1 + (1|Soum)+ (1|Org), data = td, family = binomial)  # AIC = 915
#anova(nulls.r, nulls.re, nulls.rs, nulls.rso)
anova(nulls.r, nulls.rs, nulls.rso)
anova(nulls.rso, nulls.rs, nulls.r)

```


```{r, eval = FALSE}
summary(nullw.r )
summary(nulls.r )
```
Ref: http://data.princeton.edu/wws509/R/c3s1.html  


###2.2 Winter Pasture Tenure & Rule Formality


```{r, eval = FALSE, echo = FALSE}
# old code i'm keeping in case we want to plot it again: 
# for examining the original and predicted values. 
# To visualize will have to decide a cut-off point for the fitted to assign 0/1
df.htm7<- htm7@frame
wDat <- data.frame(htm7@frame, resid=residuals(htm7,type="pearson"),fitted=fitted(htm7))

theme= theme(panel.grid.major = element_blank(),
             panel.grid.minor = element_blank(),
             panel.background = element_blank(),
             axis.text.y = element_blank(),
             axis.ticks = element_blank(),
             axis.line.x = element_line(color = "black"),
             axis.line.y = element_line(color = "black"),
             text = element_text(size = 20),
             legend.key = element_blank())
hist <- ggplot(wDat, aes(fitted, color = ResWint, fill = ResWint))
hist +
  theme +
  geom_dotplot(binwidth = 0.01, position = "jitter")+
  coord_cartesian(xlim = c(0,1))+
  xlab("Predicted value")+
  ylab(" ")+
  scale_color_manual(values = c("Maroon", "#2C3539"), #change
                     labels = c("Do Not Reserve", "Reserve"),
                     name = "Winter Pastures")+
  scale_fill_manual(values = c("Maroon", "#2C3539"), #change
                     labels = c("Do Not Reserve", "Reserve"),
                     name = "Winter Pastures")+
  geom_vline(xintercept = c(0.5), linetype = "dotdash", size = 1)

##### Let's explore the values w high predicted value but observed = 0 to see what's up. 

# filter the df of predicted vals it so it's the values on the right that were obsv No, pred Yes and look at summary stats:
#wDat%>%dplyr::filter(fitted >= 0.5) %>% filter(ResWint == 0) %>% summary_table(.)
badpred <- wDat%>%dplyr::filter(fitted >= 0.5) %>% filter(ResWint == 0)
# let's compare those to the summary stats for the correctly predicted:
#wDat%>%dplyr::filter(fitted >= 0.5) %>% filter(ResWint == 1) %>% summary_table(.)
goodpred <- wDat%>%dplyr::filter(fitted >= 0.5) %>% filter(ResWint == 1)


# merge w the original data so can visualize by EZ:

#wDat.td<- left_join(wDat, td, by = "Org")


#ggplot(badpred, aes(fitted))+geom_density()+theme_bw()

# histogram of predicted values, colored by Rule formality 
ggplot(badpred, aes(fitted, color= Rule)) + geom_density() 
# ggplot(wDat, aes(fitted, color= hhTenureWPast)) + geom_density() 
# ggplot(wDat, aes(fitted, color= hhTenureWCamp)) + geom_density() 
# ggplot(wDat, aes(fitted, color= ResWint)) + geom_density() 
```

##2.2
The base models with all params included.
```{r}
wp <- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule +  cogSC1 + bondSC + otherPast + frg.left + frgCV + (1|Org) , family = binomial, data = td.fg) 
sp <- glmer(ResSpr ~ hhTenureSpPast + hhTenureSpCamp + Rule +  cogSC1 + bondSC + otherPast + frg.left + frgCV + (1|Org) , family = binomial, data = td.fg) 
wo <- glmer(Wotor ~ hhTenureWPast + hhTenureWCamp + Rule +  cogSC1 + bondSC + otherPast + frg.left + frgCV + (1|Org) , family = binomial, data = td.fg) 
fo <- glmer(Fotor ~ hhTenureWPast + hhTenureWCamp + Rule +  cogSC1 + bondSC + otherPast + frg.left + frgCV + (1|Org) , family = binomial, data = td.fg) 

```

FULL SET OF PARAMETERS COMPARED ALL TOGETHER:
Not actually realistic, as not all hypothesized to be significant for each outcome, plus end up w very reduced sample size, but here for comparison.
```{r}
tab_model(wp, sp, wo, fo, show.aic = TRUE, show.icc = TRUE)
```


#3. MODEL COMPARISONS:
### 3.1 Reserving Wtr Pastures
Model based on hypothesized signif relationships, compared to the prior best-fit models
[Hyp model is basically the same as the best-fit forage model from before, just w Rule DV instead of the ordered]
```{r}
# comparing outputs w dummy var or ordered... 
hypw<- glmer(ResWint ~ hhTenureWPast + 
               hhTenureWCamp + 
               RuleYes + 
               RuleFormal+  
               cogSC1 + 
               frgCV + 
               frg.left+   (1|Org) , family = binomial, data = td.fg) 

hypw1<- glmer(ResWint ~ hhTenureWPast + 
                hhTenureWCamp + 
                Rule+  
                cogSC1 + 
                frg.left+  
                frgCV +  (1|Org) , family = binomial, data = td.fg) 
summary(hypw)
#anova(hypw, hypw1)  #same diff 
summary(hypw1)
```
Which Rules var to use? The ordered or the DVs? 
12/29 convo: DECIDED TO STICK W THE ORDINAL 
1/3: Realized we will have an easier time estimating probabilities while holding params constant if just use the DVs. And going to use (what was) RuleYes and RuleFormal, bc RuleYes = >0 and RuleFormal = >1
But Changed the name in the df to RuleYes


####3.1.1 Summary of results for WPasture:
Consider the odds ratios and their CIs when interpretting the pvalues. The Tenure vars have higher odds ratios, but their CIs are also very large, so they are "n.s." [Creat a vis of this]
Rules and social capital are the most strongly associated with increasing the odds that a hh will reserve Winter pastures. 
Remaining forage and the CV of forage -- we should talk about how to interpret these. Bc what this means is that for each 1% increase in remaining forage, there is a 5% incr in the odds that a hh will reserve. So this will add up fast.  See the traditional summary for a better sense of the effect size of these:
```{r}
summary(hypw)
plot_model(hypw)
```


```{r, eval = FALSE}
# visualizing the varation in intercepts across the Orgs.

int<- hypw@beta
wint<- int[1]
# explore the variation in intercepts across Orgs:
org<- coef(hypw)
Worg<- org$Org 
# Rename a column in R
colnames(Worg)[colnames(Worg)=="(Intercept)"] <- "Int"


ggplot(Worg, aes(x= (Int))) + geom_density() + geom_vline(xintercept = wint)+
  ggtitle("variation in intercept across Orgs")
 
```

####3.1.2 Examine the influence of each predictor on the probability of reserving Winter Pastures, with all else held constant:

Based on the above, the formula for Reserving winter pastures is: 
Prob Reserve WPast ~ -6.059621 + (0.662 * TenureWPast) + (0.518 * TenureWCamp) + (1.308847 * RuleYes) + (-0.215351 * RuleFormal) + (0.812 * cogSC1) + (0.048 * frg.left) + (0.046 * frgCV)


Another way to show it: The odds of reserving are = exp(everything above)
Or, we can convert that to probability of reserving with:
p= 1/(1+exp(-(everything above)))

Now we calculate a new column in the dataframe for the estimated probability of each value of X1 using the mean of X2 with the formula:

1/(1+exp(-(B0 + B1X1 + B2MeanX2 + ...))


CAN SHORTEN ALL OF THIS (vc'd and deleted) BY JUST USING THE FUNCTIONS IN sjPlot! Such as 
plot_model(x, type = "pred")
"Model predictions are based on all possible combinations of the model terms, which are - roughly speaking - created using expand.grid(). For the terms in question, all values are used for combinations. All other model predictors that are not specified in the terms-argument, are held constant (which is achieved with sjstats::typical_value()). By default, continuous variables are set to their mean, while factors are set to their reference level." <- from the documentation for sjPlot. This is essentially what I've done farther below.


Predicting probabilities for winter reserve
####3.1.3 Probability of Reserving Winter Pastures, by individual parameter 
(all remaining binary predictors held at 0, continuous params set to their mean)

Prob of Rsv WPast given varied social capital (all other params constant):

Prob of Rsv WPast given varied forage remaining (all other params constant):
Prob of Rsv WPast given CV of forage over past X yrs (all other params constant):


# SPRING PASTURES
Model based on hypothesized signif relationships
```{r}
hyps<- glmer(ResSpr ~ hhTenureSpPast + hhTenureSpCamp + RuleYes + RuleFormal +  cogSC1 + frgCV + frg.left+   (1|Org) , family = binomial, data = td.fg) 
alts<- glmer(ResSpr ~  hhTenureSpCamp +   cogSC1 + frgCV + frg.left+   (1|Org) , family = binomial, data = td.fg)
summary(hyps) # this one doesn't actually converge
summary(alts) # this one, which doesn't include the non-signif params from above, does converge. 
tab_model(hyps, alts, show.aic = TRUE) #BUT it has a much higher AIC and a lower conditional R-sq. And the parameter estimates for the signif params are essentially the same, so I'm sticking with <hyps>
```
Comparison of model results across these four parameterizations:
```{r}
tab_model(hypw, hyps,    
          show.icc = TRUE,
          show.aic = TRUE)


plot_model(hyps,
           title = "Reserve Spring Pastures", 
           sort.est = TRUE,
           auto.label = FALSE, 
           #axis.labels = c("Rules","cbrmYN","Camp Tenure", "Social Capital", "Pasture Tenure"),
          colors = "blue") 
```
Predicting probabilities for reserving Spring pastures:

The formula, based on model <hyps> above, is:
ResSPr ~ -5.417732 + 0.691647* PastureTenure + 0.571525* CampTenure + 0.383931*RulesYes + 0.430766*FormalRules + 0.691976*cogSC1 +  0.055061* frgCV + 0.035356*frg.left

####3.1.3 Probability of Reserving Winter Pastures, by individual parameter 
(all remaining binary predictors held at 0, continuous params set to their mean)

Again, these results must be considered along with the se/ CIs from the model summary. There is a LOT of variation in the answers to Pasture Tenure, so it is a poor predictor, 

##Prob of Rsv Spr Past given varied social capital (all other params constant)


##Prob of Rsv Spring Pastures given varied forage remaining (all other params constant)

##Prob of Rsv Spr Past given CV of forage over past X yrs (all other params constant)



# OTOR:

< Full model indicates Formal Rules important for OTOR, eventhough not hyp AND has opposite effects on Winter Vs. Fall Otor>

```{r, eval=FALSE}
# these are sim to above, includes ALL params, even those not hyp to be imp. 
fullwo<- glmer(Wotor ~ hhTenureWPast + hhTenureWCamp + Rule+  cogSC1 +bondSC+otherPast+ frgCV + frg.left+   (1|Org) , family = binomial, data = td.fg) 
fullwo2<- glmer(Wotor ~ hhTenureWPast + hhTenureWCamp + RuleYes+ RuleFormal+  cogSC1 +bondSC+otherPast+ frgCV + frg.left+   (1|Org) , family = binomial, data = td.fg) 
#summary(fullwo)
fullfo<- glmer(Fotor ~ hhTenureWPast + hhTenureWCamp + RuleYes+ RuleFormal+  cogSC1 +bondSC+otherPast+ frgCV + frg.left+  (1|Org) , family = binomial, data = td.fg) 
tab_model(fullwo, fullwo2,fullfo)
```
Hyp model: (based on table)
```{r}
hypwo<- glmer(Wotor ~ cogSC1 +bondSC+otherPast+ frgCV + frg.left+  (1|Org) , family = binomial, data = td.fg) 
# hypwo2<- glmer(Wotor ~ cogSC1 +bondSC+otherPast+ frgCV + frg.left+  ez+ (1|Org) , family = binomial, data = td.fg) 
hypfo<- glmer(Fotor ~ Rule +  cogSC1 +bondSC+otherPast+ frgCV + frg.left+   (1|Org) , family = binomial, data = td.fg) 
# hypfo2<- glmer(Fotor ~ Rule +  cogSC1 +bondSC+otherPast+ frgCV + frg.left+ ez+  (1|Org) , family = binomial, data = td.fg) 
```

Best fits from prior work, most parsimonious models: (hidden/not eval'd here)
```{r, eval= FALSE}
wofg1 <- glmer(Wotor ~  otherPast + frg.left+   (1|Org), 
               family = binomial, 
               data = td.fg) 
wofg1ez <- glmer(Wotor ~  otherPast + frg.left+   (1|Org), 
               family = binomial, 
               data = td.fg) 

fotor3 <-glmer(Fotor ~  otherPast + frg.left+ frgCV+  (1|Org),
              family = binomial, 
              data = td.fg)
fotor3ez <-glmer(Fotor ~  otherPast + frg.left+ frgCV+ ez+ (1|Org),
              family = binomial, 
              data = td.fg)
```

Comparing alt models:
Winter otor:  Definitely suggests we need to incorporate the Rules DVs at least.
```{r}
tab_model(fullwo2, hypwo, show.aic = TRUE)
```
But just adding Rules back isn't enough. The significant Tenure param from full model is imp:
```{r}
hypwor<- glmer(Wotor ~ cogSC1 +bondSC+otherPast+ RuleYes + RuleFormal+ frgCV + frg.left+  (1|Org) , family = binomial, data = td.fg) 
tab_model(hypwo, hypwor, show.aic = TRUE)
```
This is the best version, based on AIC scores and % variation explained...
Use this in plots below:
```{r}
hypwort<- glmer(Wotor ~ hhTenureWPast+ hhTenureWCamp+bondSC+ otherPast+ RuleYes + RuleFormal+ frgCV + frg.left+  (1|Org) , family = binomial, data = td.fg) 
#tab_model(fullwo2, hypwo, hypwor,hypwort, show.aic = TRUE)
tab_model(hypwort, show.aic = TRUE)
plot_model(hypwort)
```


```{r}
hypfor<- glmer(Fotor ~ cogSC1 +bondSC+otherPast+RuleFormal + RuleYes+ frgCV + frg.left+   (1|Org) , family = binomial, data = td.sc) 
hypfor<- glmer(Fotor ~ cogSC1 +bondSC+otherPast+RuleFormal + RuleYes+ frgCV + frg.left+   (1|Org) , family = binomial, data = td.sc) 
hypfez<- glmer(Fotor ~ cogSC1 +bondSC+otherPast+RuleFormal + RuleYes+ frgCV + frg.left+ ez+  (1|Org) , family = binomial, data = td.sc) 

```
Fall otor:
Lower AIC, but also lower Conditional R2 if keep the tenure params included....
```{r}
tab_model(hypfor,hypfez, show.aic=TRUE)
tab_model( hypfor,hypwort, show.aic=TRUE)#, 
          # pred.labels = c("Intercept", "Pasture Tenure", "Camp Tenure", "Bonding Social Capital", "Access to Pastures", "Rules", "Formal Rules", "CV of Forage", "Forage Remaining", "Cognitive Social Capital"),
          col.order = c("est", "p", "stat"),
          dv.labels = c( "Fall Otor", "Winter Otor"),
          string.pred = "Coefficient"
#          p.style = "a"  # asterisk instead of p value
  )
#plot_model(fullfo)  
plot_model(hypfor)
plot_model(hypfor, type = "pred")
plot_model(hypfez, type = "pred", terms = c("cogSC1","ez"))
plot_model(hypfez, type = "pred", terms = c("cogSC1", "RuleFormal", "ez"))
plot_model(hypfez, type = "pred", terms = c("cogSC1", "RuleFormal"))

```


# NEW WAY TO PLOT EFFECTS: separated out by ecological zone: 
```{r}
library(languageR)
dkb<- "#a6611a"
tan<- "#dfc27d"
ltgr<- "#80cdc1"
dkgr<- "#018571"
#based on EZs:
to <- mutate(td.fg, othersYes = case_when(otherPast == 1 ~ 0,   # No rules = 0
                                    otherPast == 2 | otherPast == 3 ~ 1,   # set others to 1
                                    TRUE ~ NA_real_))  
to <- mutate(to, othersOut = case_when(otherPast == 1 | otherPast == 2 ~ 0 , 
                                       otherPast == 3 ~ 1,   # access to pastures in other soums
                                    TRUE ~ NA_real_))  
to$othersYes<- as.factor(to$othersYes)
to$othersOut<- as.factor(to$othersOut)
  ds<- subset(to, to$ez==1)
  st<- subset(to, to$ez==c(2,4))
  es<- subset(to, to$ez==3)
  fms<- subset(to, to$ez==4)
```
 Winter Pastures:
```{r, eval = FALSE}
  w1<- glmer(ResWint ~ hhTenureWPast + 
               hhTenureWCamp + 
               RuleYes + 
               RuleFormal+  
               cogSC1 + 
               frgCV + 
               frg.left+   
               (1|Org) , family = binomial, data = ds)
  w2<-glmer(ResWint ~ hhTenureWPast + 
               hhTenureWCamp + 
               RuleYes + 
               RuleFormal+  
               cogSC1 + 
               #frgCV + 
               #frg.left+   
              (1|Org) , family = binomial, data = st)
  w3<- glmer(ResWint ~ hhTenureWPast + 
               hhTenureWCamp + 
               RuleYes + 
               RuleFormal+  
               cogSC1 + 
               #frgCV + 
               #frg.left+   
               (1|Org) , family = binomial, data = fms)
    w4<- glmer(ResWint ~ hhTenureWPast + 
               hhTenureWCamp + 
               RuleYes + 
               RuleFormal+  
               cogSC1 + 
               #frgCV + 
               #frg.left+   
                (1|Org) , family = binomial, data = es)

  # Pasture Tenure  
plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor= dkb, lwd=4,xlabel="Pasture Tenure (No/Yes)", ylabel="Probability of Reserving", pred = c(hhTenureWPast)) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c(hhTenureWCamp), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c(hhTenureWCamp), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c(hhTenureWCamp), addToExistingPlot = TRUE) 

  # Camp Tenure  
plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Camp Tenure (No/Yes)", ylabel="Probability of Reserving", pred = c(hhTenureWCamp)) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c(hhTenureWCamp), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c(hhTenureWCamp), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c(hhTenureWCamp), addToExistingPlot = TRUE) 

  # Any Rules

plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Any Rules Re: Timing of Grazing (No/Yes)", ylabel="Probability of Reserving", pred = c("RuleYes")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("RuleYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("RuleYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("RuleYes"), addToExistingPlot = TRUE) 

  # Formal Rules

plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="FORMAL Rules (No/Yes)", ylabel="Probability of Reserving", pred = c("RuleFormal")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("RuleFormal"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("RuleFormal"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("RuleFormal"), addToExistingPlot = TRUE) 


  # cogSC1

plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Cognitive Social Captial", ylabel="Probability of Reserving", pred = c("cogSC1")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("cogSC1"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("cogSC1"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("cogSC1"), addToExistingPlot = TRUE) 


  # remaining forage

plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Forage Remaining (%)", ylabel="Probability of Reserving", pred = c("frg.left")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("frg.left"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("frg.left"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("frg.left"), addToExistingPlot = TRUE) 

  # CV forage

plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="CV of Forage (%)", ylabel="Probability of Reserving", pred = c("frgCV")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("frgCV"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("frgCV"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("frgCV"), addToExistingPlot = TRUE) 

```


NEW WAY TO PLOT EFFECTS: separated out by ecological zone: 
Spring Pastures
```{r, eval = FALSE}

 s1<- glmer(ResSpr ~ hhTenureSpPast + 
               hhTenureSpCamp + 
               RuleYes + 
               RuleFormal+  
               cogSC1 + 
               frgCV + 
               frg.left+   (1|Org) , family = binomial, data = ds)
  s2<-glmer(ResSpr ~ hhTenureSpPast + 
               hhTenureSpCamp  + 
               RuleYes + 
               RuleFormal+  
               cogSC1 + 
               frgCV + 
               frg.left+   (1|Org) , family = binomial, data = st)
  s3<- glmer(ResSpr ~ hhTenureSpPast + 
               hhTenureSpCamp  + 
               RuleYes + 
               RuleFormal+  
               cogSC1 + 
               frgCV + 
               frg.left+   (1|Org) , family = binomial, data = fms)
   s4<- glmer(ResSpr ~ #hhTenureSpPast + 
               #hhTenureSpCamp + 
               RuleYes + 
               RuleFormal+  
               #cogSC1 + 
               #frgCV + 
               #frg.left+   
                (1|Org) , family = binomial, data = es)

  # Pasture Tenure  
plotLMER.fnc(s1,ylimit=0:1,lockYlim=TRUE,linecolor= dkb, lwd=4,xlabel="Pasture Tenure (No/Yes)", ylabel="Probability of Reserving Spr", pred = c("hhTenureSpPast")) 

plotLMER.fnc(s2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("hhTenureSpPast"), addToExistingPlot = TRUE) 

plotLMER.fnc(s3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("hhTenureSpPast"), addToExistingPlot = TRUE) 

plotLMER.fnc(s4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("hhTenureSpPast"), addToExistingPlot = TRUE) 

  # Camp Tenure  
plotLMER.fnc(s1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Camp Tenure (No/Yes)", ylabel="Probability of Reserving", pred = c("hhTenureSpCamp")) 

plotLMER.fnc(s2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("hhTenureSpCamp"), addToExistingPlot = TRUE) 

plotLMER.fnc(s3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("hhTenureSpCamp"), addToExistingPlot = TRUE) 

plotLMER.fnc(s4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("hhTenureSpCamp"), addToExistingPlot = TRUE) 

  # Any Rules

plotLMER.fnc(s1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Rules Re:Timing of Grazing (No/Yes)", ylabel="Probability of Reserving", pred = c("RuleYes")) 

plotLMER.fnc(s2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("RuleYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(s3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("RuleYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(s4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("RuleYes"), addToExistingPlot = TRUE) 

  # Formal Rules

plotLMER.fnc(s1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="FORMAL Rules (No/Yes)", ylabel="Probability of Reserving", pred = c("RuleFormal")) 

plotLMER.fnc(s2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("RuleFormal"), addToExistingPlot = TRUE) 

plotLMER.fnc(s3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("RuleFormal"), addToExistingPlot = TRUE) 

plotLMER.fnc(s4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("RuleFormal"), addToExistingPlot = TRUE) 


  # cogSC1

plotLMER.fnc(s1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Cognitive Social Captial", ylabel="Probability of Reserving", pred = c("cogSC1")) 

plotLMER.fnc(s2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("cogSC1"), addToExistingPlot = TRUE) 

plotLMER.fnc(s3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("cogSC1"), addToExistingPlot = TRUE) 

plotLMER.fnc(s4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("cogSC1"), addToExistingPlot = TRUE) 


  # remaining forage

plotLMER.fnc(s1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Forage Remaining (%)", ylabel="Probability of Reserving", pred = c("frg.left")) 

plotLMER.fnc(s2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("frg.left"), addToExistingPlot = TRUE) 

plotLMER.fnc(s3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("frg.left"), addToExistingPlot = TRUE) 

plotLMER.fnc(s4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("frg.left"), addToExistingPlot = TRUE) 

  # CV forage

plotLMER.fnc(s1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="CV of Forage (%)", ylabel="Probability of Reserving", pred = c("frgCV")) 

plotLMER.fnc(s2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Reserving", pred = c("frgCV"), addToExistingPlot = TRUE) 

plotLMER.fnc(s3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Reserving", pred = c("frgCV"), addToExistingPlot = TRUE) 

plotLMER.fnc(s4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Reserving", pred = c("frgCV"), addToExistingPlot = TRUE) 

```


Winter Otor
```{r}
#summary(hypwort)
w1<- glmer(Wotor  ~ hhTenureWPast + 
               hhTenureWCamp + 
               RuleYes + 
               RuleFormal+  
               bondSC +
               othersYes+
               othersOut+
               frgCV + 
               frg.left+   (1|Org) , family = binomial, data = ds)
  w2<-glmer(Wotor  ~ hhTenureWPast + 
               hhTenureWCamp + 
               RuleYes + 
               RuleFormal+  
               bondSC +
               othersYes+
               othersOut+
               frgCV + 
               frg.left+   (1|Org) , family = binomial, data = st)
  w3<- glmer(Wotor  ~ hhTenureWPast + 
               hhTenureWCamp + 
               RuleYes + 
               RuleFormal+  
               bondSC +
                othersYes+
               othersOut+
               frgCV + 
               frg.left+   (1|Org) , family = binomial, data = fms)
    w4<- glmer(Wotor  ~ #hhTenureWPast + 
               #hhTenureWCamp + 
               RuleYes + 
               RuleFormal+  
               #bondSC +
               othersYes+
               othersOut+
               #frgCV + 
               #frg.left+   
                (1|Org) , family = binomial, data = es)
# Pasture Tenure  
plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor= dkb, lwd=4,xlabel="Pasture Tenure (No/Yes)", ylabel="Probability of Wtr Otor", pred = c("hhTenureWPast")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("hhTenureWPast"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("hhTenureWPast"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("hhTenureWPast"), addToExistingPlot = TRUE) 


  # Any Rules

plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Rules Re: Timing of Grazing", ylabel="Probability of Wtr Otor", pred = c("RuleYes")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleYes"), addToExistingPlot = TRUE) 

  # Formal Rules

plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="FORMAL Rules (No/Yes)", ylabel="Probability of Wtr Otor", pred = c("RuleFormal")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleFormal"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleFormal"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleFormal"), addToExistingPlot = TRUE) 

# Access to other pastures

plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Access to other pastures (No/Yes)", ylabel="Probability of Wtr Otor", pred = c("othersYes")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersYes"), addToExistingPlot = TRUE) 

# Access to other pastures in another soum

plotLMER.fnc(w1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Access to other soum pastures", ylabel="Probability of Wtr Otor", pred = c("othersOut")) 

plotLMER.fnc(w2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersOut"), addToExistingPlot = TRUE) 

plotLMER.fnc(w3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersOut"), addToExistingPlot = TRUE) 

plotLMER.fnc(w4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersOut"), addToExistingPlot = TRUE) 
```
Fall Otor
```{r}
#summary(hypwort)
f1<- glmer(Fotor ~ cogSC1 + 
                bondSC + 
             othersYes + 
             othersOut +
             RuleFormal + 
             RuleYes +  
             frgCV + 
             frg.left + (1 | Org) , family = binomial, data = ds)

f2<- glmer(Fotor ~ cogSC1 + 
                bondSC + 
             othersYes + 
             othersOut +
             RuleFormal + 
             RuleYes +  
             frgCV + 
             frg.left + (1 | Org) , family = binomial, data = st)
f3<- glmer(Fotor ~ cogSC1 + 
                bondSC + 
             othersYes + 
             othersOut +
             RuleFormal + 
             RuleYes +  
             frgCV + 
             frg.left + (1 | Org) , family = binomial, data = fms)
f4<- glmer(Fotor ~ cogSC1 + 
                bondSC + 
             othersYes + 
             othersOut +
             RuleFormal + 
             RuleYes +  
             frgCV + 
             frg.left + (1 | Org) , family = binomial, data = es)


  # Formal Rules

plotLMER.fnc(f1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="FORMAL Rules (No/Yes)", ylabel="Probability of Fall Otor", pred = c("RuleFormal")) 

plotLMER.fnc(f2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleFormal"), addToExistingPlot = TRUE) 

plotLMER.fnc(f3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleFormal"), addToExistingPlot = TRUE) 

plotLMER.fnc(f4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleFormal"), addToExistingPlot = TRUE) 


  # Any Rules

plotLMER.fnc(f1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Rules Re: Timing of Grazing", ylabel="Probability of Fall Otor", pred = c("RuleYes")) 

plotLMER.fnc(f2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(f3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(f4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("RuleYes"), addToExistingPlot = TRUE) 

# Access to other pastures

plotLMER.fnc(f1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Access to other pastures (No/Yes)", ylabel="Probability of Fall Otor", pred = c("othersYes")) 

plotLMER.fnc(f2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(f3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersYes"), addToExistingPlot = TRUE) 

plotLMER.fnc(f4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersYes"), addToExistingPlot = TRUE) 

# Access to other pastures in another soum

plotLMER.fnc(f1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Access to other soum pastures", ylabel="Probability of Fall Otor", pred = c("othersOut")) 

plotLMER.fnc(f2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersOut"), addToExistingPlot = TRUE) 

plotLMER.fnc(f3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersOut"), addToExistingPlot = TRUE) 

plotLMER.fnc(f4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("othersOut"), addToExistingPlot = TRUE) 

# Remaining forage

plotLMER.fnc(f1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="Remaining Forage (%)", ylabel="Probability of Fall Otor", pred = c("frg.left")) 

plotLMER.fnc(f2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("frg.left"), addToExistingPlot = TRUE) 

plotLMER.fnc(f3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("frg.left"), addToExistingPlot = TRUE) 

plotLMER.fnc(f4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("frg.left"), addToExistingPlot = TRUE) 

# CV of forage

plotLMER.fnc(f1,ylimit=0:1,lockYlim=TRUE,linecolor=dkb, lwd=4,xlabel="CV of Forage (%)", ylabel="Probability of Fall Otor", pred = c("frgCV")) 

plotLMER.fnc(f2,ylimit=0:1,lockYlim=TRUE,linecolor= tan, lwd=4, ylabel="Probability of Wtr Otor", pred = c("frgCV"), addToExistingPlot = TRUE) 

plotLMER.fnc(f3,ylimit=0:1,lockYlim=TRUE,linecolor=ltgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("frgCV"), addToExistingPlot = TRUE) 

plotLMER.fnc(f4,ylimit=0:1,lockYlim=TRUE,linecolor=dkgr, lwd=4, ylabel="Probability of Wtr Otor", pred = c("frgCV"), addToExistingPlot = TRUE) 
```

```{r,eval=FALSE}
# visualizing the varation in intercepts across the Orgs.

int<- bestSp@beta
Spint<- int[1]
# explore the variation in intercepts across Orgs:
org<- coef(bestSp)
Sorg<- org$Org 
# Rename a column in R
colnames(Sorg)[colnames(Sorg)=="(Intercept)"] <- "Int"


ggplot(Sorg, aes(x= (Int))) + geom_density() + geom_vline(xintercept = Spint)


```

**Interpretting the odds ratios:**  tenure on the spring pasture, membership in a formal CBRM and cognitive social capital all increase the odds that a household will reserve the spring pastures. Rules (re: timing of grazing) were not significant, but the coeffs indicate that the negative impact of NOT having rules on the odds of reserving pasture.. Conditional R2 describes the proportion of variance explained by both the fixed and random factors ... which, doesn't seem great?


In the meantime, here's the original and predicted values. 
To visualize will have to decide a cut-off point for the fitted to assign 0/1
```{r }
# code adapted from Stats of Doom
df.bestSp<- sfm1@frame
spDat <- data.frame(sfm1@frame, resid=residuals(sfm1,type="pearson"),fitted=fitted(sfm1))

theme= theme(panel.grid.major = element_blank(),
             panel.grid.minor = element_blank(),
             panel.background = element_blank(),
             axis.text.y = element_blank(),
             axis.ticks = element_blank(),
             axis.line.x = element_line(color = "black"),
             axis.line.y = element_line(color = "black"),
             text = element_text(size = 20),
             legend.key = element_blank())
hist = ggplot(spDat, aes(fitted, color = ResSpr, fill = ResSpr))
hist +
  theme +
  geom_dotplot(binwidth = 0.01, position = "jitter")+
  coord_cartesian(xlim = c(0,1))+
  xlab("fitted value for probability reserve patures")+
  ylab(" ")+
  scale_color_manual(values = c("Maroon", "#2C3539"), #change
                     labels = c("Do Not Reserve", "Reserve"),
                     name = "Spring Pastures")+
  scale_fill_manual(values = c("Maroon", "#2C3539"), #change
                     labels = c("Do Not Reserve", "Reserve"),
                     name = "Spring Pastures")+
  geom_vline(xintercept = c(0.5), linetype = "dotdash", size = 1)


ggplot(spDat, aes(fitted, color= ResSpr)) + geom_density() +
  scale_color_manual(values = c("Maroon", "#2C3539"), #change
                     labels = c("Do Not Reserve", "Reserve"),
                     name = "Spring Pastures")+
  scale_fill_manual(values = c("Maroon", "#2C3539"), #change
                     labels = c("Do Not Reserve", "Reserve"),
                     name = "Spring Pastures")+
  geom_vline(data= filter(spDat, ResSpr == 1), aes(xintercept=median(fitted, na.rm=T)),  
               color="#2C3539", linetype="dashed", size=1)+
  geom_vline(data= filter(spDat, ResSpr == 0), aes(xintercept=median(fitted, na.rm=T)),  
               color="Maroon", linetype="dashed", size=1)+
  theme

```

```{r}

# histogram of predicted values, colored by Rule formality 
ggplot(spDat, aes(fitted, color= RuleYes)) + geom_density() 
ggplot(spDat, aes(fitted, color= hhTenureSpPast)) + geom_density() 
ggplot(spDat, aes(fitted, color= cbrmYN)) + geom_density() 

# boxplot of fitted values by Rule and hh Tenure on W Pasture
f<- ggplot(wDat, aes(x=Rule, y = fitted))
f+ geom_boxplot() +
  theme_bw() +
  xlab("Rule formality")+
  ylab("predicted probability reserve patures") +
  facet_grid(.~hhTenureWPast) 
  

```





### SOCIAL CAPITAL & RULES ...  

Given what we see above wrt the (weak) relationship between (this particular set of) Rules and (this one) Practice, does this mean for our hypothesized relationships between Social Capital and the prevalance of Informal vs. Formal Rules? Does it vary by TYPE of pasture/season under consideration? Stronger relationship between rule formality and social capital for the Winter pastures compared to Spring pastures.

**Original Hypothesis:**  
  Increased cognitive social capital will lead to more prevalence of *informal* rules (within certain ecological zones)
  Rules ~ Social Capital + ecological zone

But is there a chance that we have the order/direction of causality wrong in that?
  It could be Soc Cap ~ Rules + ez
    - or -
  Soc Cap ~ Rules + (1|ez)  NO. More likely Rule as a results of SC not other way around.
  
#### SC1 
```{r, message = FALSE, warning= FALSE}
library(MASS)
# need to use MASS::polr for ordered logistic regression
rezm<- polr(Rule ~ ez, data = td, method = c("logistic"))
rscm<- polr(Rule ~ cogSC1 , data = td, method = c("logistic"))
rse1<- polr(Rule ~ cogSC1 + ez, data = td, method = c("logistic"))
#anova(rezm, rscm) # big improvement by including ez, as we predicted
summary(rse1) # outputs are re: prob of being in that class or lower
#intercepts are the zetas
focal.predictors <- c("cogSC1", "ez")
mod <- rse1
xlevels <- list(cogSC1=8, ez=c(1,2,3,4))
Effect(focal.predictors, mod,
       xlevels= list(cogSC1=8, ez=c(1,2,3,4)), 
       #fixed.predictors,
       vcov.=vcov, se=TRUE, 
       latent=FALSE)



#  Tenure as predicted by Rule formality and EZ
rtez<- glm(hhTenureWPast ~ Rule + ez +cogSC1, data= td, family = "binomial")
summary(rtez)
# :
rtez_dat <- cbind(expand.grid(Rule=c(0,1,2),  ez = rep(1:4, 100), cogSC1=seq(0,2, 0.25))) #hhTenureWPast= c(0,1),
rtez_dat <- cbind(expand.grid(Rule=c(0,1,2),  ez = rep(1:4), cogSC1=seq(0,2, 0.25))) #hhTenureWPast= c(0,1),

# start w just one value for each
#fo_dat <- cbind(expand.grid(otherPast=c(1,2,3),Rule=c(0,1,2), hhTenureWPast= c(0,1), cogSC1=seq(0,2, 0.25)))

rtez_dat %<>% mutate_at(1, funs(ordered(.)))
rtez_dat %<>% mutate_at(c(2), funs(factor(.)))

rtezPred <- predict(rtez, rtez_dat, type="response")
rtezpredDat <- data.frame(rtez_dat, rtezPred)

#rnewdat<- cbind(rtez_dat, predict(rtez, rtez_dat, type = "response"))
# this doesn't work bc not ordered response....
#rtnewdat <- data.table::melt(rnewdat, id.vars = c("cogSC1", "ez"),
 #                variable.name = "Rule_Level", value.name = "Probability")


# scm<- lm(cogSC1 ~ ez, data =td, method = c("logistic"))
# scm1<- lm(cogSC1 ~ Rule, data =td, method = c("logistic"))
# anova(scm, scm1)
# scm<- glmer(cogSC1 ~ Rule + (1|ez), data =td)
# summary(scm)

# FITTED VALS:
fit.rse<- rse1$fitted.values
colnames(fit.rse)<- c("None", "Informal", "Formal")
rse.df<- data.frame(fit.rse, rse1$model)

# rse_dat <- data.frame(cogSC1 = seq(0, 2, length.out= 200), ez = rep(1:4, 50))
# rse_dat <- cbind(expand.grid(ez = seq(1,4, 1), cogSC1 = seq(0, 2, 0.1)))
# 
# rse_dat$ez<- as.factor(rse_dat$ez)
# newdat<- cbind(rse_dat, predict(rse1, rse_dat, type = "probs"))
# 
# 
# lnewdat <- melt(newdat, id.vars = c("cogSC1", "ez"),
#                 variable.name = "Rule_Level", value.name = "Probability")

rse.df<- gather(rse.df, "Level", "PredProb", 1:3)

ggplot(rse.df, aes(x= cogSC1, y=PredProb, color= Level )) +
  #geom_smooth()+  
  geom_line()+
  #geom_smooth(position=position_jitter(width=.01,height=.01))+
  coord_cartesian(xlim = c(0,2), ylim = c(0,0.75))+
  xlab("Cognitive Social Capital")+
  ylab("Pred Prob of Class Membership") +
  facet_grid(Rule~ez, labeller = label_both)


# ggplot(lnewdat, aes(x= cogSC1, y= Probability, color = Rule_Level))+
#   geom_smooth()+
#     facet_grid(.~ez)+
#   # coord_cartesian(xlim = c(0,2), ylim = c(0,0.75))+
#   xlab("Cognitive Social Capital")+
#   ylab("Pred Prob of Class Membership") 

ggplot(rtezpredDat, aes(x= cogSC1, y= rtezPred, color = Rule))+
  geom_smooth()+
  facet_grid(.~ez)+
   #coord_cartesian(xlim = c(0,2), ylim = c(0,0.75))+
  xlab("Cognitive Social Capital")+
  ylab("Pred Prob of Class Membership") 


ggplot(rtezpredDat, aes(x= rtezPred, y= cogSC1))+
  geom_bin2d()+
  facet_grid(ez~Rule)+
   #coord_cartesian(xlim = c(0,2), ylim = c(0,0.75))+
  xlab("Cognitive Social Capital")+
  ylab("Pred Prob of Class Membership") 
```

Big improvement by including ez, as we predicted

# returns predicted class membership, so look for the highest estimated probability in each zone.
Edit this to create a table:
```{r}
# EZ = 1
predict(rse1, newdata = data.frame(ez="1"),type="p") #0 = No rules, Inf next
# EZ = 2
predict(ezm, newdata = data.frame(ez="2"),type="p") #1 = Inf, formal next
#EZ = 3
predict(ezm, newdata = data.frame(ez="3"),type="p") #1 = Inf, then no, then formal
#EZ = 4
predict(ezm, newdata = data.frame(ez="4"),type="p") #1 = Inf, then formal next


# calc cumulative probabilities of having certain rule formality:
exp(ezm$zeta - ezm$coefficients)/(1 + exp(ezm$zeta - ezm$coefficients))

# how would this apply w a 
exp(rse1$zeta - rse1$coefficients)/(1 + exp(rse1$zeta - rse1$coefficients))


#ggplot(scm.df, aes(x=)) 
```








**Separating out the data by ecological zone** 
to try to understand why having issues trying to incorporate ez:  
td by ez
```{r}
mfs <- td %>% filter(ez == 4)%>% drop_na()
ds  <- td.sc %>% filter(ez == 1)%>% drop_na()
st  <- td.sc %>% filter(ez == 2) %>% drop_na()

```
Now separate models for each ez

1st: Rules by EZ:
```{r}
# singular fit warning, but does yield diff coefficients for Rules by ez....
mtez<- glmer(ResWint ~ Rule + (1+ Rule|ez), family = binomial,data = td) 
coef(mtez)
```
Now separate models for each ez... based on the full models above:
htm7 <- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule + cbrmYN+ cogSC1 +   (1|Org) , family = binomial, data = td.sc)
htmSp <- glmer(ResSpr ~ hhTenureSpPast + cbrmYN + RuleYes + cogSC1 + (1|Org) , family = binomial, data = td ) 

**This isn't working out**  
So i'm hiding it for now.
None fitting? Intercept only models best for DS and ST?  
And social capital the only signif param in FMS? 
```{r, echo = FALSE, eval = FALSE}
mt.null <-  glm( ResWint ~ 1, data=mfs, family=binomial)
ds.null <-  glm( ResWint ~ 1, data=ds, family=binomial)
st.null <-  glm( ResWint ~ 1, data=st, family=binomial)

  # this model will not converge unless all of these parameters are included??
#mtm <- glmer(ResWint ~ TenureWPast + Rule + cbrmYN + cogSC1 + (1|Org) , data = mfs, family = "binomial")

mtmp <- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule + cbrmYN+ cogSC1 +   (1|Org) , family = binomial, data = mfs)
stmp <- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule + cbrmYN+ cogSC1 +   (1|Org) , family = binomial, data = st)
dsmp <- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule + cbrmYN+ cogSC1 +   (1|Org) , family = binomial, data = ds)


#dsmp <- glm(ResWint ~  hhTenureWPast+ hhTenureWCamp + Rule + cogSC1 , data = ds, family = "binomial")
dsfull <- glm(ResWint ~  hhTenureWPast+ hhTenureWCamp + cbrmYN+ Rule + cogSC1 , data = st, family = "binomial")
step(dsfull)
  # NONE OF THIS IS SIGNIF???
stfull <- glm(ResWint ~  hhTenureWPast+ hhTenureWCamp + cbrmYN+ RuleYes + cogSC1 , data = st, family = "binomial")
back<- step(stfull)

```


more histograms of params divided out by EZ:
```{r}
ggplot(ds, aes(cogSC1))+geom_density()+facet_grid(.~Rule)
ggplot(mfs, aes(cogSC1))+geom_density()+facet_grid(.~Rule)
ggplot(st, aes(cogSC1))+geom_density()+facet_grid(.~Rule)
ggplot(td, aes(cogSC1))+geom_density()+facet_wrap(.~Rule*ez)+theme_bw()

```



## ALSO NEED TO LOOK AT PREDICTED VALUES/DISTRIBUTIONS:
Our goal here is to calculate a predicted probability of Reserving Winter Pastures, for specific values of the predictors:
Tenure = 1
Rules = 1 vs. 2
cogSC1 continuous values.
To do that, create a dataframe w the specified values:
But we'll need to consider all combinations in order to really predict.

```{r}

      ##### THESE ARE NOT RUN W THE RANDOM INTERCEPT ####

finalW <- glm(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule + cogSC1, family = binomial, data = td)


finalWfg<- 

# start w just one value for each
p_dat <- cbind(expand.grid(hhTenureWPast=c(0,1),hhTenureWCamp=c(0,1),Rule=c(0,1,2), cogSC1=seq(0,2, .25)))

p_dat %<>% mutate_at(c(1:2), funs(factor(.)))
p_dat %<>% mutate_at(3, funs(ordered(.)))





#predict(finalW, p_dat, type="response")
wPred<- predict(finalW, p_dat, type="response")

predDat <- data.frame(p_dat, wPred)


twp<- ggplot(predDat, aes(x= wPred, y=hhTenureWPast))+
  geom_dotplot(binaxis = "y", stackdir = "center")+
  coord_cartesian(xlim = c(0,1))+
  xlab("predicted value for probability reserve patures")+
  ylab("Tenure on Winter Pasture ")
twp

twp<- ggplot(predDat, aes(x= wPred, color=hhTenureWPast))+
  geom_density()+
  coord_cartesian(xlim = c(0,1))+
  xlab("predicted value for probability reserve patures")+
  ylab("Tenure on Winter Pasture ")
twp

twc<- ggplot(predDat, aes(x= wPred, color=hhTenureWCamp))+
  geom_density()+
  coord_cartesian(xlim = c(0,1))+
  xlab("predicted value for probability reserve patures")+
  ylab("Tenure on Winter Camp ")

rf<- ggplot(predDat, aes(x= wPred, color=Rule))+
  geom_density()+
  coord_cartesian(xlim = c(0,1))+
  xlab("predicted value for probability reserve patures")+
  ylab("Rule formality ")+
    #geom_vline(data= filter(predDat, Rule == 1), aes(xintercept=median(fitted, na.rm=T)),  
      #         color="#2C3539", linetype="dashed", size=1)+
  geom_vline(data= filter(predDat, Rule == 1), aes(xintercept=median(wPred, na.rm=T)) ,  
               color="#2C3539", linetype="dashed", size=1)+
  geom_vline(data= filter(predDat, Rule == 0), aes(xintercept=median(wPred, na.rm=T)),  
               color="Maroon", linetype="dashed", size=1)
rf


ggplot(predDat, aes(x= cogSC1, y= wPred, color = Rule))+
  geom_smooth()+
  coord_cartesian(xlim = c(0,2))+
  xlab("cognitive social capital")+
  ylab("predicted prob of reserving W pasture") +
  facet_wrap(.~hhTenureWPast)

ggplot(predDat, aes(x= wPred, y= hhTenureWPast, color = Rule))+
    geom_point(shape=1,position=position_jitter(width=.1,height=.1))

ggplot(predDat, aes(x= wPred, y= hhTenureWCamp, color = Rule))+
    geom_point(shape=1,position=position_jitter(width=.1,height=.1))

ggplot(td, aes(x= cogSC1, y= Rule))+
    geom_point(shape=1,position=position_jitter(width=.1,height=.1))+
    facet_wrap(.~ez)

```

Looking more at the predicted values:

```{r}
predDat%>%group_by(hhTenureWPast)%>%
  summarise(pred= median(wPred))

predDat%>%group_by(hhTenureWCamp)%>%
  summarise(pred= median(wPred))

predDat%>%group_by(Rule)%>%
  summarise(pred= median(wPred))


```

THESE DON"T INCLUDE THE RANDOM EFFECT>>>>>
```{r}
finalS <- glm(ResSpr ~ hhTenureSpCamp + hhTenureSpPasture +cbrmYN + RuleYes + cogSC1, family = binomial, data = td)

# start w just one value for each
sp_dat <- cbind(expand.grid(hhTenureSpCamp=c(0,1),cbrmYN=c(0,1),Rule=c(0,1,2), cogSC1=seq(0,2, .25)))

sp_dat %<>% mutate_at(c(1:2), funs(factor(.)))
sp_dat %<>% mutate_at(3, funs(ordered(.)))





#predict(finalW, p_dat, type="response")
sPred<- predict(finalS, sp_dat, type="response")

spredDat <- data.frame(sp_dat, sPred)


ggplot(spredDat, aes(x= sPred, y=hhTenureSpCamp))+
  geom_dotplot(binaxis = "y", stackdir = "center")+
  coord_cartesian(xlim = c(0,1))+
  xlab("predicted value for probability reserve patures")+
  ylab("Tenure on Spring Pasture ")


ggplot(spredDat, aes(x= sPred, color=hhTenureSpCamp))+
  geom_density()+
  coord_cartesian(xlim = c(0,1))+
  xlab("predicted value for probability reserve patures")+
  ylab("Tenure on Spring Pasture ")


ggplot(spredDat, aes(x= sPred, color=Rule))+
  geom_density()+
  coord_cartesian(xlim = c(0,1))+
  xlab("predicted value for probability reserve patures")+
  ylab("Rule formality ")

ggplot(spredDat, aes(x= cogSC1, y= sPred, color = Rule))+
  geom_smooth()+  
  #geom_smooth(position=position_jitter(width=.01,height=.01))+
  coord_cartesian(xlim = c(0,2))+
  xlab("cognitive social capital")+
  ylab("predicted prob of reserving Sp pasture") +
  facet_wrap(.~hhTenureSpCamp)

ggplot(spredDat, aes(x= sPred, y= hhTenureSpCamp, color = Rule))+
    geom_point(shape=1,position=position_jitter(width=.1,height=.1))


```

Looking more at the predicted values:

```{r}
spredDat%>%group_by(hhTenureSpPast)%>%
  summarise(pred= median(sPred))

spredDat%>%group_by(hhTenureSpCamp)%>%
  summarise(pred= median(sPred))

spredDat%>%group_by(Rule)%>%
  summarise(pred= median(sPred))


```

NOT USEFUL YET
```{r, eval = FALSE}
theme= theme(panel.grid.major = element_blank(),
             panel.grid.minor = element_blank(),
             panel.background = element_blank(),
             axis.text.y = element_blank(),
             axis.ticks = element_blank(),
             axis.line.x = element_line(color = "black"),
             axis.line.y = element_line(color = "black"),
             text = element_text(size = 20),
             legend.key = element_blank())
hist<- ggplot(predDat, aes(x= wPred, y= hhTenureWPast)) # color = ResWint, fill = ResWint))
hist +
  theme +
  #geom_dotplot(binwidth = 0.01, position = "jitter")+
  geom_dotplot(binaxis = "y")+
  coord_cartesian(xlim = c(0,1))+
  xlab("predicted value for probability reserve patures")+
  ylab("Tenure on Winter Pasture ")+
  scale_color_manual(values = c("DkBlue", "#2C3539"), #change
                     labels = c("Do Not Reserve", "Reserve"),
                     name = "Spring Pastures")+
  scale_fill_manual(values = c("DkBlue", "#2C3539"), #change
                     labels = c("Do Not Reserve", "Reserve"),
                     name = "Winter Pastures")+
  geom_vline(xintercept = c(0.5), linetype = "dotdash", size = 1)




r.betas<- ggplot(mz.or, aes(x= ez, y = beta))+ 
  geom_point(size = 2)+
  theme+
   coord_cartesian(ylim = c(0,2))

kable(mz.or, format = "markdown")
```










# Create a new dataframe that includes population of people and livestock (as of now just aimag level #s, but woudl be interesting to look at soum level too)

```{r, eval = FALSE}
pop<- read.csv("./data/mor2data/2009Population.csv", header = TRUE)
# human population in thousands
# lsk population in thousands 

td$Aimag<- str_trim(td$Aimag, side = "both")

pop %<>% dplyr::select(-aimag)

#paused 
#td.a <- left_join(td, pop, by = c("Aimag"))
#td.a<- td.a %>% drop_na()
```

# FORAGE USE
11/26:Forage use is a highly significant parameter in the Winter model, but there doesn't seem to be much var in values between Res Wtr and No....and the effect size is low.

12/1: 1. Whiel I though tit made sense to use Soum as the RE here, actually that performs much more poorly, and get way better model fit if continue to use Org as the RE parameter.
2. What is the most appropriate way to indicate that forage use params are the same for all hh within the same Soum? It's a Soum-level var rather than a hh-level one.
```{r}
#WINTER:

# To load the dataframe that has frg use in it:
load("./data/tdfg.RData")
# switching the direction of forage use:
  # so that the results can be interpretted a little more easily:
td.fg %<>% mutate(frg.left =(100-frgUse))
td.fg<- rename(td.fg, frg.avg = frgUse, frg.cv = CV)


# Deprecatred bc Soum not useful RE:
  #wfm<- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule +  cogSC1 + frg.left+   (1|Soum) , family = binomial, data = td.fg)  

  #BEST:
wfm0<- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule +  cogSC1 + frg.left+   (1|Org) , family = binomial, data = td.fg)  

wfm2<- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule +  cogSC1 + frg.left+  frg.cv+ (1|Org) , family = binomial, data = td.fg) 

wm<- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule +  cogSC1 +    (1|Org) , family = binomial, data = td.fg)  

#wfm<- glmer(ResWint ~ hhTenureWCamp + Rule +  cogSC1 + frg.left+   (1|Org) , family = binomial, data = td.fg) 

tab_model(wm,wfm2, wfm0,   show.aic = TRUE)
# wm<- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule +  cogSC1 +    (1|Org) , family = binomial, data = td)  

#  Nesting frg.avg within Soum:
# wfm<- glmer(ResWint ~ hhTenureWPast + hhTenureWCamp + Rule +  cogSC1 + (1|Soum) + (Soum:frg.avg) , family = binomial, data = td.fg)  

```


```{r}
# deprecated bc the other models have better fit w Org param for RE, and for Spring there isn't a huge diff between them, so sticking w Org:
#sfm<- glmer(ResSpr ~ hhTenureSpPast + hhTenureSpCamp + Rule + cogSC1 +frg.left + frg.cv + (1|Soum), family = binomial, data = td.fg)

sfm0<- glmer(ResSpr ~ hhTenureSpPast + hhTenureSpCamp + RuleYes + cogSC1 +frg.left + frg.cv + (1|Org), family = binomial, data = td.fg)

sfm1<- glmer(ResSpr ~ hhTenureSpPast + hhTenureSpCamp + RuleYes + cogSC1 +frg.left  + (1|Org), family = binomial, data = td.fg)

sfm2<- glmer(ResSpr ~ hhTenureSpPast + hhTenureSpCamp + RuleYes + cogSC1 +frg.cv +  (1|Org), family = binomial, data = td.fg)

sm<- glmer(ResSpr ~ hhTenureSpPast + hhTenureSpCamp + RuleYes + cogSC1 + (1|Org), family = binomial, data = td.fg)

sfm3<- glmer(ResSpr ~ hhTenureSpPast + hhTenureSpCamp + cogSC1+ frg.left + frg.cv  + (1|Org), family = binomial, data = td.fg)

# sfm3.1<- glmer(ResSpr ~ hhTenureSpCamp + cogSC1+ frg.left + frg.cv  + (1|Org), family = binomial, data = td.fg)

tab_model(sfm0,sfm1, sfm2, sfm3, show.aic = TRUE)

tab_model(sfm1, sm, show.aic = TRUE)

ggplot(td.fg, aes(x= frg.left, color = ResSpr))+geom_density(na.rm = TRUE)

# remove the RE for prediction 
# start w just one value for each
sp_dat <- cbind(expand.grid(hhTenureSpPast=c(0,1),
                           hhTenureSpCamp=c(0,1),
                          # otherPast = c(1,2,3),
                           RuleYes=c(0,1), 
                           cogSC1=seq(0,2, .1),
                           frg.left = seq(0,100,1),
                           frg.cv = seq(0,100,1)
                           ))


sp_dat %<>% mutate_at(c(1:2), funs(factor(.)))
sp_dat %<>% mutate_at(3:4, funs(ordered(.)))

sfmod<- glm(ResSpr~ hhTenureSpPast + hhTenureSpCamp + RuleYes + cogSC1 +frg.left + frg.cv,
            family = binomial, 
            data = td.fg)  
#predict(finalW, p_dat, type="response")
sfPred<- predict(sfmod, sp_dat, type="response")
predsfDat <- data.frame(sp_dat, sfPred)


# grid by Tenure
ggplot(predsfDat, aes(x= cogSC1, y = sfPred, color = RuleYes))+
  geom_smooth()+
  coord_cartesian(xlim = c(0,2), ylim = c(0,1))+
  xlab("cognitive social capital")+
  ylab("predicted prob of reserving spring pasture") +
  facet_grid(.~hhTenureSpPast, labeller = label_both)

```

#Otor x forage -- 
  Note: for this as well it seems that using Org as the RE results in better fit to data than Soum as RE.
For this as well it appears that going on otor is related to having access and also forage used... but why is THIS one negative? I would think that going on otor would be infl by having low availab resources.... but it seems to neg afect it? 
```{r}
#wofg <- glmer(Wotor ~  otherPast + Rule +  cogSC1 +frg.left+   (1|Soum), family = binomial, data = td.fg) 
# wofg1 <- glmer(Wotor ~  otherPast + Rule +  bondSC +frg.avg+   (1|Soum), family = binomial, data = td.fg) 
  # BEST:

wofg  <- glmer(Wotor ~  otherPast +   (1|Org), 
               family = binomial, 
               data = td.fg) 
wofg1 <- glmer(Wotor ~  otherPast + frg.left+   (1|Org), 
               family = binomial, 
               data = td.fg) 
wofg2 <- glmer(Wotor ~  otherPast + frgCV+ (1|Org), 
               family = binomial, 
               data = td.fg)

wofg3 <- glmer(Wotor ~  otherPast + frg.left + frgCV+ (1|Org), 
               family = binomial, 
               data = td.fg)
wofg4 <- glmer(Wotor ~  otherPast +frg.left+   Rule + cogSC1 + (1|Org), 
               family = binomial, 
               data = td.fg) 
# wofg01 <- glmer(Wotor ~ otherPast +Rule + cogSC1 + frg.left+  frg.cv+ (1|Org),
#                 family = binomial, 
#                 data = td.fg) 

   # Use this one for the prediction figure below, bc it includes Rules:
wofr <- glmer(Wotor ~  otherPast +Rule  + frg.left+  (1|Org), 
              family = binomial, data = td.fg) 


tab_model( wofg, wofg1, wofg2, wofg3,wofg4, show.aic = TRUE)

  # Best
fotor <-glmer(Fotor ~  otherPast + Rule +  cogSC1 + frg.left+ frgCV+  (1|Org),
              family = binomial, 
              data = td.fg)
  # no different, so using for 


fotor <-glmer(Fotor ~  otherPast +  (1|Org),
              family = binomial, 
              data = td.fg)
fotor1 <-glmer(Fotor ~  otherPast +  frg.left+  (1|Org),
              family = binomial, 
              data = td.fg)
fotor2 <-glmer(Fotor ~  otherPast + frgCV+  (1|Org),
              family = binomial, 
              data = td.fg)
fotor3 <-glmer(Fotor ~  otherPast + frg.left+ frgCV+  (1|Org),
              family = binomial, 
              data = td.fg)
fotor4 <-glmer(Fotor ~  otherPast + Rule +  cogSC1 + frgCV+  (1|Org), 
               family = binomial, 
               data = td.fg)
fotor5 <-glmer(Fotor ~  otherPast + Rule +  cogSC1 +  (1|Org), 
               family = binomial, 
               data = td.fg)
tab_model(fotor, fotor1, fotor2, fotor3, fotor4, fotor5, show.aic = TRUE)

# BEST OF FALL AND WINTER
tab_model(fotor3, wofg1, show.aic = TRUE)
```




# old OTOR models
Before including forage use.

TO: Examine w Fall Otor
    Explore impact of social network strength--impact of network ouside the soum

First determining the correct random effect term:
```{r}
wotor1 <- glmer(Wotor ~ hhTenureWPast + otherPast + Rule +  cogSC1 +   (1|Org), family = binomial, data = td) 

wotor2 <- glmer(Wotor ~ hhTenureWPast + otherPast + Rule +  cogSC1 +   (1|Soum), family = binomial, data = td) 

tab_model(wotor1, wotor2)
plot_models(wotor1, wotor2)

tab_model(wotor1, show.aic = TRUE, show.icc= TRUE, rm.terms = "Rule.Q", 
          title = "Winter Otor",
          pred.labels = c("Intercept", 
                          "Tenure: Wtr Pasture", 
                          "Access to Other Pastures", 
                          "Rule formality", 
                          #"Rule-quadratic", 
                          "Cognitive SC"))

```
The Conditional R^2 and the AIC support RE for Org over Soum.

Inclusion of diff terms:
    NEED TO TRY W CBRM? No, bc redundant w Org
  WINTER OTOR
```{r}
wotor1 <- glmer(Wotor ~ hhTenureWPast + otherPast + Rule +  cogSC1 +   (1|Org), family = binomial, data = td.sc)


wotor2 <- glmer(Wotor ~ hhTenureWPast + otherPast + Rule +  bondSC +   (1|Org), family = binomial, data = td.sc)

wotor3 <- glmer(Wotor ~  otherPast + Rule + hhTenureWPast+  (1|Org), family = binomial, data = td)
  # w just Tenure not Rules
wotor4 <- glmer(Wotor ~  otherPast + hhTenureWPast+ (1|Org), family = binomial, data = td)
  # w just Rule not Tenure
wotor5 <-glmer(Wotor ~  otherPast + Rule+ (1|Org), family = binomial, data = td)

  # w Just access to other pastures:
wotor6 <-glmer(Wotor ~  otherPast + (1|Org), family = binomial, data = td)

#anova(wotor1, wotor3, wotor4, wotor5, wotor6)

tab_model(wotor3, wotor4, wotor5, wotor6, show.aic = TRUE, show.icc = FALSE)

```

  FALL OTOR
  (more suport for Org as RE than Soum)
```{r}
fotor1 <- glmer(Fotor ~  otherPast + Rule +  cogSC1 + hhTenureWPast +  (1|Org), family = binomial, data = td.sc)
  # structSC
# fotor2 <- glmer(Fotor ~ hhTenureWPast + otherPast + Rule +  strSC2+  (1|Org), family = binomial, data = td.sc)
  # with just the bondingSC:
fotor2 <- glmer(Fotor ~ hhTenureWPast + otherPast + Rule +  bondSC+  (1|Org), family = binomial, data = td)

fotor3 <- glmer(Fotor ~  otherPast + Rule +  cogSC1 +  (1|Org), family = binomial, data = td)
#tab_model(fotor1, fotor2,fotor3, show.aic = TRUE)

fotor4<- glmer(Fotor ~  otherPast + Rule +    (1|Org), family = binomial, data = td)
tab_model(fotor1, fotor2,fotor3, fotor4, show.aic = TRUE)


#anova(fotor1, fotor3, fotor4, fotor5, fotor6)

tab_model(fotor3, fotor4, fotor5, fotor6, wshow.aic = TRUE, show.icc = FALSE)



plot_model(bestSp,
           title = "Reserve Spring Pastures", 
           sort.est = TRUE,
           #auto.label = FALSE, 
           axis.labels = c("Rules","cbrmYN","Camp Tenure", "Social Capital", "Pasture Tenure"),
           colors = "blue") 


tab_model(fotor1, show.aic = TRUE, show.icc= TRUE, rm.terms = "Rule.Q", 
          title = "Fall Otor",
          pred.labels = c("Intercept", 
                          "Tenure: Wtr Pasture", 
                          "Access to Other Pastures", 
                          "Rule formality", 
                          "Rule-quadratic", 
                          "Cognitive SC"))

```

  

# GETTING PREDICTED DATA:
```{r}
# haven't figured out how to do this with the RE included so have to redo w/o
wot<- glm(Wotor ~  otherPast + frg.left + Rule + cogSC1, family = binomial, data = td.fg)


# start w just one value for each
wo_dat <- cbind(expand.grid(otherPast=c(1,2,3),
                            Rule=c(0,1,2), 
                            hhTenureWPast= c(0,1), 
                            hhTenureWCamp = c(0,1), 
                            cogSC1=seq(0,2, 0.1), 
                            frg.left = seq(0,100,1),
                            frg.cv = seq(0,50,1)
                            ))
wo_dat %<>% mutate_at(c(1:2), funs(ordered(.)))
wo_dat %<>% mutate_at(3:4, funs(factor(.)))

#predict
woPred<- predict(wot, wo_dat, type="response")
wopredDat <- data.frame(wo_dat, woPred)

ggplot(wopredDat, aes(x= frg.left, y=(woPred*100), color = Rule)) +
   #geom_smooth()+
   geom_smooth(position=position_jitter(width=0.1,height=0.1))+
   coord_cartesian(xlim = c(0,100))+
   xlab("frg.left")+
   ylab("predicted prob of winter otor") +
   facet_grid(.~otherPast, labeller = label_both)

ggplot(wopredDat, aes(x= cogSC1, y=woPred, color = Rule)) +
   #geom_smooth()+
   geom_smooth(position=position_jitter(width=0,height=.001))+
   coord_cartesian(xlim = c(0,2))+
   xlab("cognitive social capital")+
   ylab("predicted prob of winter otor") +
   facet_grid(.~otherPast, labeller = label_both)


# w forage available:
ggplot(wofupredDat, aes(x= frg.avg, y=wofuPred, color= Rule)) +
#geom_smooth()+
geom_smooth(position=position_jitter(width=.001,height=.001))+
coord_cartesian(xlim = c(0,100))+
xlab("forage use")+
ylab("predicted prob of winter otor") +
facet_grid(.~otherPast, labeller = label_both)


```
Fall Otor Predicted

```{r}
# haven't figured out how to do this with the RE included so have to redo w/o
fot<- glm(Fotor ~  otherPast + Rule + hhTenureWPast + cogSC1, family = binomial, data = td)

fotorgm <-glm(Fotor ~  otherPast + Rule +  cogSC1 + frg.cv, family = binomial, data = td.fg)

fotorav <-glm(Fotor ~  otherPast +   cogSC1 + frg.left + frg.cv, family = binomial, data = td.fg)

# start w just one value for each
fo_dat <- cbind(expand.grid(otherPast=c(1,2,3),
                            Rule=c(0,1,2), 
                            #hhTenureWPast= c(0,1), 
                            cogSC1=seq(0,2, 0.25),
                            frg.cv=seq(0,100,1)
                            ))

fo_dat %<>% mutate_at(c(1:2), funs(ordered(.)))
#fo_dat %<>% mutate_at(3, funs(factor(.)))


#predict(finalW, p_dat, type="response")
foPred<- predict(fotorgm, fo_dat, type="response")
fopredDat <- data.frame(fo_dat, foPred)

foPredav<- predict(fotorav, fo_dat_av, type="response")
fopredDatav <- data.frame(fo_dat_av, foPredav)

```

Then plot the predicted data:
```{r}

plot(woPred~otherPast, data= wopredDat)

  #FALL OTOR:
ggplot(fopredDat, aes(x= frg.cv, y=foPred, color= Rule)) +
  geom_smooth()+  
  #geom_smooth(position=position_jitter(width=.01,height=.01))+
  coord_cartesian(xlim = c(0,100))+
  xlab("% forage remaining")+
  ylab("predicted prob of fall otor") +
  facet_grid(.~otherPast, labeller = label_both)

# w model that includes frg.avg in addition to frg.cv
## yields approx the same plot
ggplot(fopredDatav, aes(x= frg.cv, y=foPredav, color= Rule)) +
  geom_smooth()+  
  #geom_smooth(position=position_jitter(width=.01,height=.01))+
  coord_cartesian(xlim = c(0,100))+
  xlab("CV forage use")+
  ylab("predicted prob of fall otor") +
  facet_grid(.~otherPast, labeller = label_both)

ggplot(fopredDat, aes(x= cogSC1, y=foPred, color= Rule)) +
  geom_smooth()+  
  #geom_smooth(position=position_jitter(width=.01,height=.01))+
  coord_cartesian(xlim = c(0,2))+
  xlab("cognitive social capital")+
  ylab("predicted prob of fall otor") +
  facet_grid(.~otherPast, labeller = label_both)
```

```{r}
ggplot(td.fg, aes(x= frg.avg, y = frg.cv, color = ez)) + 
  geom_point() +
  xlab("Percent Forage Use")+
  ylab("LT CV of % Forage Use")
  
```


#Null models for all response vars: Intercept only-models.
steps Ref'd from http://data.princeton.edu/wws509/R/c3s1.html
the estimate of the constant is the logit of the proportion Reservign Pastures:
```{r}
nullw<-  glm( ResWint ~ 1, data=td.fg, family=binomial)
nullSp<- glm( ResSpr ~1, data= td.fg, family = binomial)
nullwo<- glm( Wotor ~1, data= td.fg, family = binomial)
nullfo<- glm( Fotor ~1, data= td.fg, family = binomial)

```
Null w/ only the grouping factor specified
```{r}
nullw1<-  glmer( ResWint ~ 1 + (1|Org), data=td.fg, family=binomial)
nullSp1<- glmer( ResSpr ~1 + (1|Org), data= td.fg, family = binomial)
nullwo1<- glmer( Wotor ~1 + (1|Org), data= td.fg, family = binomial)
nullfo1<- glmer( Fotor ~1 + (1|Org), data= td.fg, family = binomial)
```
